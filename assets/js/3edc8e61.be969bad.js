"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8738],{2522:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"authentication/hmac","title":"HMAC Authentication","description":"Site Availability uses HMAC (Hash-based Message Authentication Code) authentication to secure the /sync endpoint, which enables federation between multiple Site Availability instances.","source":"@site/docs/authentication/hmac.md","sourceDirName":"authentication","slug":"/authentication/hmac","permalink":"/site-availability/docs/authentication/hmac","draft":false,"unlisted":false,"editUrl":"https://github.com/Levy-Tal/site-availability/tree/main/docs/docs/authentication/hmac.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Troubleshooting","permalink":"/site-availability/docs/usage/troubleshooting"},"next":{"title":"Architecture Overview","permalink":"/site-availability/docs/development/architecture"}}');var t=i(4848),r=i(8453);const l={},o="HMAC Authentication",a={},c=[{value:"Overview",id:"overview",level:2},{value:"How HMAC Works",id:"how-hmac-works",level:2},{value:"Signature Generation",id:"signature-generation",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Server Configuration (Providing /sync endpoint)",id:"server-configuration-providing-sync-endpoint",level:3},{value:"Client Configuration (Site Source)",id:"client-configuration-site-source",level:3},{value:"HTTP Headers",id:"http-headers",level:2},{value:"Request Flow",id:"request-flow",level:2},{value:"Example Request",id:"example-request",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Token Management",id:"token-management",level:3},{value:"Network Security",id:"network-security",level:3},{value:"Example Token Generation",id:"example-token-generation",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Debug Logging",id:"debug-logging",level:3},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Key Functions",id:"key-functions",level:3},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"hmac-authentication",children:"HMAC Authentication"})}),"\n",(0,t.jsxs)(n.p,{children:["Site Availability uses HMAC (Hash-based Message Authentication Code) authentication to secure the ",(0,t.jsx)(n.code,{children:"/sync"})," endpoint, which enables federation between multiple Site Availability instances."]}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"HMAC authentication ensures that:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Requests to the ",(0,t.jsx)(n.code,{children:"/sync"})," endpoint are authenticated using a shared secret token"]}),"\n",(0,t.jsx)(n.li,{children:"Messages cannot be tampered with during transmission"}),"\n",(0,t.jsx)(n.li,{children:"Replay attacks are prevented using timestamp validation"}),"\n",(0,t.jsx)(n.li,{children:"Only authorized instances can access federation endpoints"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"how-hmac-works",children:"How HMAC Works"}),"\n",(0,t.jsx)(n.p,{children:"HMAC authentication uses SHA-256 and includes:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Shared Token"}),": A secret token configured on both the server (providing the endpoint) and client (accessing the endpoint)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Timestamp"}),": RFC3339 formatted timestamp included in each request"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Signature"}),": HMAC-SHA256 signature calculated from the timestamp and request body"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Headers"}),": Authentication information transmitted via HTTP headers"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"signature-generation",children:"Signature Generation"}),"\n",(0,t.jsx)(n.p,{children:"The HMAC signature is generated using:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"HMAC-SHA256(token, timestamp + request_body)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Where:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"token"})," is the shared secret"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"timestamp"})," is the RFC3339 formatted current time"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"request_body"})," is the HTTP request body (empty for GET requests)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"server-configuration-providing-sync-endpoint",children:"Server Configuration (Providing /sync endpoint)"}),"\n",(0,t.jsxs)(n.p,{children:["Enable the sync endpoint and configure a token in your ",(0,t.jsx)(n.code,{children:"config.yaml"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  sync_enable: true\n  token: "your-strong-secret-token"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"client-configuration-site-source",children:"Client Configuration (Site Source)"}),"\n",(0,t.jsx)(n.p,{children:"Configure the site source to authenticate with the remote server:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'sources:\n  - name: "remote-site"\n    type: "site"\n    config:\n      url: "https://remote-site.example.com"\n      token: "your-strong-secret-token" # Same token as server\n'})}),"\n",(0,t.jsx)(n.h2,{id:"http-headers",children:"HTTP Headers"}),"\n",(0,t.jsx)(n.p,{children:"HMAC authentication uses two custom headers:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"X-Site-Sync-Timestamp"}),": RFC3339 formatted timestamp"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"X-Site-Sync-Signature"}),": Hex-encoded HMAC-SHA256 signature"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"request-flow",children:"Request Flow"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Client"})," generates RFC3339 timestamp"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Client"})," calculates HMAC signature using token, timestamp, and request body"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Client"})," sends request with timestamp and signature headers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Server"})," validates the signature matches expected value"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Server"})," validates timestamp is within 5-minute window (prevents replay attacks)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Server"})," processes request if validation passes"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"example-request",children:"Example Request"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:"GET /sync HTTP/1.1\nHost: remote-site.example.com\nX-Site-Sync-Timestamp: 2024-01-15T10:30:00Z\nX-Site-Sync-Signature: a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456\n"})}),"\n",(0,t.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,t.jsx)(n.h3,{id:"token-management",children:"Token Management"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use strong tokens"}),": Generate cryptographically secure random tokens (recommended: 32+ characters)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Store securely"}),": Keep tokens in secure configuration files with restricted permissions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rotate regularly"}),": Change tokens periodically and update all instances"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Don't log tokens"}),": Ensure tokens are not logged in application logs"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"network-security",children:"Network Security"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use HTTPS"}),": Always use HTTPS for production deployments"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Timestamp validation"}),": 5-minute window prevents replay attacks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate limiting"}),": Consider implementing rate limiting on the ",(0,t.jsx)(n.code,{children:"/sync"})," endpoint"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"example-token-generation",children:"Example Token Generation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Generate a secure token\nopenssl rand -hex 32\n"})}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"401 Unauthorized"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check that tokens match exactly on both server and client"}),"\n",(0,t.jsx)(n.li,{children:"Verify timestamp is within 5-minute window"}),"\n",(0,t.jsx)(n.li,{children:"Ensure HTTPS is used if required"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Clock Skew"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Synchronize clocks on all instances using NTP"}),"\n",(0,t.jsx)(n.li,{children:"The system allows up to 5 minutes of clock difference"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Invalid Signature"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Verify token configuration"}),"\n",(0,t.jsx)(n.li,{children:"Check for any modifications to request headers or body"}),"\n",(0,t.jsx)(n.li,{children:"Ensure proper URL encoding"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"debug-logging",children:"Debug Logging"}),"\n",(0,t.jsx)(n.p,{children:"Enable debug logging to troubleshoot HMAC issues:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"logging:\n  level: debug\n"})}),"\n",(0,t.jsx)(n.p,{children:"Look for log entries containing:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'"Generated HMAC signature for site sync request"'}),"\n",(0,t.jsx)(n.li,{children:'"HMAC validation failed"'}),"\n",(0,t.jsx)(n.li,{children:'"Timestamp validation failed"'}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,t.jsx)(n.p,{children:"The HMAC authentication is implemented in:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"backend/authentication/hmac/hmac.go"})," - Core HMAC validation logic"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"backend/handlers/handlers.go"})," - ",(0,t.jsx)(n.code,{children:"/sync"})," endpoint protection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"backend/scraping/site/site.go"})," - Client-side signature generation"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"key-functions",children:"Key Functions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ValidateRequest()"})," - Validates both HMAC signature and timestamp"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"GenerateSignature()"})," - Creates HMAC signature for outbound requests"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ValidateTimestamp()"})," - Ensures request is within time window"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/site-availability/docs/usage/configuration/sources/site",children:"Site Source Configuration"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/site-availability/docs/usage/configuration/server",children:"Server Configuration"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/site-availability/docs/api/endpoints",children:"API Endpoints"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var s=i(6540);const t={},r=s.createContext(t);function l(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);