"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8531],{4373:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"usage/configuration/server","title":"Server Configuration","description":"Basic Settings","source":"@site/docs/usage/configuration/server.md","sourceDirName":"usage/configuration","slug":"/usage/configuration/server","permalink":"/site-availability/docs/usage/configuration/server","draft":false,"unlisted":false,"editUrl":"https://github.com/Levy-Tal/site-availability/tree/main/docs/docs/usage/configuration/server.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Quick Start","permalink":"/site-availability/docs/usage/quickstart"},"next":{"title":"Site Source Configuration","permalink":"/site-availability/docs/usage/configuration/sources/site"}}');var r=s(4848),t=s(8453);const l={sidebar_position:1},o="Server Configuration",a={},c=[{value:"Basic Settings",id:"basic-settings",level:2},{value:"Port Configuration",id:"port-configuration",level:3},{value:"Custom CA Certificates",id:"custom-ca-certificates",level:3},{value:"Host URL Configuration",id:"host-url-configuration",level:3},{value:"Proxy Header Trust Configuration",id:"proxy-header-trust-configuration",level:3},{value:"Authentication",id:"authentication",level:2},{value:"Local Admin Authentication",id:"local-admin-authentication",level:3},{value:"Security Features",id:"security-features",level:4},{value:"Password Security Best Practices",id:"password-security-best-practices",level:4},{value:"Authorization",id:"authorization",level:2},{value:"Role-Based Access Control",id:"role-based-access-control",level:3},{value:"Admin Role",id:"admin-role",level:4},{value:"Custom Roles",id:"custom-roles",level:4},{value:"How Authorization Works",id:"how-authorization-works",level:4},{value:"API Behavior with Authorization",id:"api-behavior-with-authorization",level:4},{value:"Example Scenarios",id:"example-scenarios",level:4},{value:"Multi-Role Support",id:"multi-role-support",level:4},{value:"OIDC Authentication",id:"oidc-authentication",level:2},{value:"Configuration",id:"configuration",level:3},{value:"OIDC Provider Setup",id:"oidc-provider-setup",level:3},{value:"Keycloak Example",id:"keycloak-example",level:4},{value:"Generic OIDC Provider",id:"generic-oidc-provider",level:4},{value:"User and Group Mapping",id:"user-and-group-mapping",level:3},{value:"User-Based Mapping",id:"user-based-mapping",level:4},{value:"Group-Based Mapping",id:"group-based-mapping",level:4},{value:"Fallback Mechanism",id:"fallback-mechanism",level:3},{value:"OIDC Security Features",id:"oidc-security-features",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Common Issues",id:"common-issues",level:4},{value:"Error Messages",id:"error-messages",level:4},{value:"Security Considerations",id:"security-considerations",level:3},{value:"Metrics Authentication",id:"metrics-authentication",level:2},{value:"Configuration",id:"configuration-1",level:3},{value:"Authentication Types",id:"authentication-types",level:3},{value:"Basic Authentication",id:"basic-authentication",level:4},{value:"Bearer Token Authentication",id:"bearer-token-authentication",level:4},{value:"Security Best Practices",id:"security-best-practices",level:3},{value:"Disabling Metrics Authentication",id:"disabling-metrics-authentication",level:3},{value:"Troubleshooting",id:"troubleshooting-1",level:3},{value:"Common Issues",id:"common-issues-1",level:4},{value:"Error Messages",id:"error-messages-1",level:4},{value:"Excluded Endpoints",id:"excluded-endpoints",level:4},{value:"Sync Configuration",id:"sync-configuration",level:2},{value:"Labels",id:"labels",level:2},{value:"Complete Example",id:"complete-example",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"server-configuration",children:"Server Configuration"})}),"\n",(0,r.jsx)(n.h2,{id:"basic-settings",children:"Basic Settings"}),"\n",(0,r.jsx)(n.p,{children:"The server configuration includes basic networking and operational settings."}),"\n",(0,r.jsx)(n.h3,{id:"port-configuration",children:"Port Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  port: "8080"\n  host_url: "https://myserver.com" # Required: The public URL of your server\n'})}),"\n",(0,r.jsx)(n.h3,{id:"custom-ca-certificates",children:"Custom CA Certificates"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  port: "8080"\n  host_url: "https://myserver.com"\n  custom_ca_path: "/path/to/custom/ca.crt"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"host-url-configuration",children:"Host URL Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"host_url"})," field is ",(0,r.jsx)(n.strong,{children:"required"})," and serves multiple important purposes:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"OIDC Callback URLs"}),": Used to construct secure callback URLs for OIDC authentication"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security"}),": Prevents Host header injection attacks by using a trusted configuration value instead of request headers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Protocol Handling"}),": Ensures the correct protocol (http/https) is used for all callback URLs"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Format"}),": Must include the full URL with scheme and host:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.code,{children:"https://myserver.com"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.code,{children:"http://localhost:8080"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.code,{children:"myserver.com"})," (missing scheme)"]}),"\n",(0,r.jsxs)(n.li,{children:["\u274c ",(0,r.jsx)(n.code,{children:"https://myserver.com/"})," (trailing slash will be automatically trimmed)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Examples"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Production\nhost_url: "https://monitoring.company.com"\n\n# Development\nhost_url: "http://localhost:8080"\n\n# With custom port\nhost_url: "https://monitoring.company.com:8443"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"proxy-header-trust-configuration",children:"Proxy Header Trust Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["When running behind a reverse proxy (nginx, ingress controller, etc.), the ",(0,r.jsx)(n.code,{children:"trust_proxy_headers"})," setting allows the application to properly detect HTTPS connections:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  port: "8080"\n  host_url: "https://myserver.com"\n  trust_proxy_headers: true # Only enable when behind a trusted reverse proxy\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Security Considerations"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Default"}),": ",(0,r.jsx)(n.code,{children:"false"})," - Only trusts direct TLS connections (",(0,r.jsx)(n.code,{children:"r.TLS != nil"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"When enabled"}),": Trusts ",(0,r.jsx)(n.code,{children:"X-Forwarded-Proto"}),", ",(0,r.jsx)(n.code,{children:"X-Forwarded-SSL"}),", and ",(0,r.jsx)(n.code,{children:"X-Forwarded-Port"})," headers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Only enable"})," when your application is behind a trusted reverse proxy that sets these headers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Never enable"})," in environments where untrusted clients can directly reach your application"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,r.jsx)(n.p,{children:"Site Availability Monitor supports authentication to secure access to the monitoring interface."}),"\n",(0,r.jsx)(n.h3,{id:"local-admin-authentication",children:"Local Admin Authentication"}),"\n",(0,r.jsx)(n.p,{children:"Enable local admin authentication to require login before accessing the dashboard:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  session_timeout: "12h" # Session duration (default: 12h)\n  local_admin:\n    enabled: true # Enable authentication\n    username: "admin" # Admin username\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Credentials file"})," (",(0,r.jsx)(n.code,{children:"credentials.yaml"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  local_admin:\n    password: "your-secure-password"\n'})}),"\n",(0,r.jsx)(n.h4,{id:"security-features",children:"Security Features"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secure Sessions"}),": Cryptographically secure session IDs with configurable timeout"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Password Security"}),": Supports both plaintext (development) and bcrypt hashed passwords"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Protected Endpoints"}),": All ",(0,r.jsx)(n.code,{children:"/api/*"})," endpoints require authentication when enabled"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Session Cookies"}),": HttpOnly cookies with CSRF protection"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"password-security-best-practices",children:"Password Security Best Practices"}),"\n",(0,r.jsx)(n.p,{children:"For production environments, use bcrypt hashed passwords:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Generate a bcrypt hash"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Using htpasswd (if available)\necho "your-password" | htpasswd -bnBC 12 "" | tr -d \':\\n\'\n\n# Or use online bcrypt generators with cost factor 12\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use the hash in credentials.yaml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  local_admin:\n    password: "$2b$12$rDKx8UXp3F8P7xYV9oGzTeBN6K8aHVWHZxXzGQQJ8E1QXh8l2F9Da"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"authorization",children:"Authorization"}),"\n",(0,r.jsx)(n.h3,{id:"role-based-access-control",children:"Role-Based Access Control"}),"\n",(0,r.jsx)(n.p,{children:"When authentication is enabled, you can configure role-based authorization to control which labels and apps users can access."}),"\n",(0,r.jsx)(n.h4,{id:"admin-role",children:"Admin Role"}),"\n",(0,r.jsxs)(n.p,{children:["The local admin user automatically has the ",(0,r.jsx)(n.strong,{children:"admin"})," role with full access to all labels and apps."]}),"\n",(0,r.jsx)(n.h4,{id:"custom-roles",children:"Custom Roles"}),"\n",(0,r.jsx)(n.p,{children:"Define custom roles in the configuration to control label access:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  roles:\n    # Frontend team role - can see frontend apps\n    frontend:\n      team: "frontend"\n      env: "production"\n\n    # Backend team role - can see backend and shared apps\n    backend:\n      team: "backend"\n      shared: "yes"\n\n    # DevOps role - can see multiple environments\n    devops:\n    env: "production"\n    region: "us-east"\n\n    # QA role - can see staging environment\n    qa:\n      env: "staging"\n'})}),"\n",(0,r.jsx)(n.h4,{id:"how-authorization-works",children:"How Authorization Works"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Label Filtering"}),": Users can only see labels they have permission for"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"App Filtering"}),": Users can only see apps that have at least one label they're authorized for"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Location Filtering"}),": Users only see locations that contain authorized apps"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"api-behavior-with-authorization",children:"API Behavior with Authorization"}),"\n",(0,r.jsx)(n.p,{children:"When a user makes API requests:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/api/labels"})}),": Returns only label keys the user has access to"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/api/labels?team"})}),': Returns only values for the "team" label that the user can see']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/api/apps"})}),": Returns only apps with labels the user is authorized for"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/api/locations"})}),": Returns only locations containing authorized apps"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"example-scenarios",children:"Example Scenarios"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Frontend Team User"})," (role: ",(0,r.jsx)(n.code,{children:"frontend"}),"):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Can see: ",(0,r.jsx)(n.code,{children:"team=frontend"})," and ",(0,r.jsx)(n.code,{children:"env=production"})," labels"]}),"\n",(0,r.jsxs)(n.li,{children:["Apps visible: Only apps with ",(0,r.jsx)(n.code,{children:"team=frontend"})," OR ",(0,r.jsx)(n.code,{children:"env=production"})]}),"\n",(0,r.jsxs)(n.li,{children:["Labels endpoint returns: ",(0,r.jsx)(n.code,{children:'["team", "env"]'})]}),"\n",(0,r.jsx)(n.li,{children:"Apps endpoint returns: Apps matching their label permissions"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Admin User"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Can see: All labels and apps"}),"\n",(0,r.jsx)(n.li,{children:"No filtering applied"}),"\n",(0,r.jsx)(n.li,{children:"Full access to all monitoring data"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"multi-role-support",children:"Multi-Role Support"}),"\n",(0,r.jsx)(n.p,{children:"Users can have multiple roles. The system combines permissions from all roles:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# If a user has both "frontend" and "qa" roles, they can see:\n# - team=frontend (from frontend role)\n# - env=production (from frontend role)\n# - env=staging (from qa role)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"oidc-authentication",children:"OIDC Authentication"}),"\n",(0,r.jsx)(n.p,{children:"Site Availability supports OpenID Connect (OIDC) authentication for integration with enterprise identity providers like Keycloak, Auth0, Azure AD, and others."}),"\n",(0,r.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Configure OIDC in your ",(0,r.jsx)(n.code,{children:"config.yaml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  port: "8080"\n  host_url: "https://myserver.com" # Required: Used for OIDC callback URLs\n  session_timeout: 12h\n\n  # Define roles and their label permissions\n  roles:\n    frontend:\n      team: frontend\n      env: production\n    backend:\n      team: backend\n    admin: {} # Empty means full access\n\n  # OIDC Configuration\n  oidc:\n    enabled: true\n    config:\n      name: "Keycloak" # Display name for the provider\n      issuer: "https://keycloak.example.com/realms/master"\n      clientID: "site-availability"\n      groupScope: "groups" # Claim name for user groups\n      userNameScope: "preferred_username" # Claim name for username\n    permissions:\n      users:\n        # Map specific users to roles\n        john.doe:\n          - frontend\n          - backend\n        admin.user:\n          - admin\n      groups:\n        # Map OIDC groups to roles\n        developers:\n          - frontend\n          - backend\n        devops:\n          - admin\n        qa-team:\n          - qa\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Add the client secret in your ",(0,r.jsx)(n.code,{children:"credentials.yaml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  oidc:\n    config:\n      clientSecret: "your-oidc-client-secret"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"oidc-provider-setup",children:"OIDC Provider Setup"}),"\n",(0,r.jsx)(n.h4,{id:"keycloak-example",children:"Keycloak Example"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Create a new client in Keycloak"}),"\n",(0,r.jsx)(n.li,{children:'Set client type to "OpenID Connect"'}),"\n",(0,r.jsxs)(n.li,{children:["Configure redirect URI: ",(0,r.jsx)(n.code,{children:"https://myserver.com/auth/oidc/callback"})," (uses your ",(0,r.jsx)(n.code,{children:"host_url"})," setting)"]}),"\n",(0,r.jsx)(n.li,{children:'Enable "Client authentication"'}),"\n",(0,r.jsx)(n.li,{children:"Add groups to the client scope"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"generic-oidc-provider",children:"Generic OIDC Provider"}),"\n",(0,r.jsx)(n.p,{children:"Ensure your OIDC provider includes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"groups"})," claim in ID tokens (or configure ",(0,r.jsx)(n.code,{children:"groupScope"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"preferred_username"})," or similar claim (configure ",(0,r.jsx)(n.code,{children:"userNameScope"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Standard OpenID Connect discovery endpoint"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important"}),": The callback URL will be automatically constructed as ",(0,r.jsx)(n.code,{children:"{host_url}/auth/oidc/callback"}),". Make sure to configure this exact URL in your OIDC provider."]}),"\n",(0,r.jsx)(n.h3,{id:"user-and-group-mapping",children:"User and Group Mapping"}),"\n",(0,r.jsx)(n.h4,{id:"user-based-mapping",children:"User-Based Mapping"}),"\n",(0,r.jsx)(n.p,{children:"Map individual users to roles:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"permissions:\n  users:\n    alice@example.com:\n      - frontend\n      - qa\n    bob@example.com:\n      - admin\n"})}),"\n",(0,r.jsx)(n.h4,{id:"group-based-mapping",children:"Group-Based Mapping"}),"\n",(0,r.jsx)(n.p,{children:"Map OIDC groups to application roles:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"permissions:\n  groups:\n    frontend-team:\n      - frontend\n    backend-team:\n      - backend\n    devops-team:\n      - admin\n"})}),"\n",(0,r.jsx)(n.h3,{id:"fallback-mechanism",children:"Fallback Mechanism"}),"\n",(0,r.jsx)(n.p,{children:"If the OIDC provider is unavailable, you can configure local admin as a fallback:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"server_settings:\n  # OIDC configuration (primary)\n  oidc:\n    enabled: true\n    # ... oidc config ...\n\n  # Local admin fallback\n  local_admin:\n    enabled: true\n    username: admin\n"})}),"\n",(0,r.jsx)(n.p,{children:"When OIDC provider is down:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Users will see a warning message"}),"\n",(0,r.jsx)(n.li,{children:"Local admin authentication remains available"}),"\n",(0,r.jsx)(n.li,{children:"Server continues to operate normally"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"oidc-security-features",children:"OIDC Security Features"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"State Parameter"}),": CSRF protection using cryptographically secure state"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Token Validation"}),": Full JWT signature verification"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Timeout Handling"}),": 10-second timeout for provider initialization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secure Cookies"}),": HttpOnly, Secure, and SameSite cookie attributes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Graceful Degradation"}),": Automatic fallback to local auth when provider unavailable"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Host URL Protection"}),": Uses configured ",(0,r.jsx)(n.code,{children:"host_url"})," instead of request headers to prevent Host header injection attacks"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h4,{id:"common-issues",children:"Common Issues"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Provider Unreachable"}),": Check issuer URL and network connectivity"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Invalid Client"}),": Verify clientID and clientSecret"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Missing Claims"}),": Ensure groups and username scopes are configured"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Redirect Mismatch"}),": Verify redirect URI in provider matches application"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Missing host_url"}),": Ensure ",(0,r.jsx)(n.code,{children:"host_url"})," is configured in ",(0,r.jsx)(n.code,{children:"server_settings"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Invalid host_url format"}),": Must include scheme (http:// or https://) and host"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"OIDC Authentication Fails"}),": All session cookies use SameSite=Lax for cross-site compatibility"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cookies Not Secure Behind Proxy"}),": Enable ",(0,r.jsx)(n.code,{children:"trust_proxy_headers: true"})," when behind a reverse proxy"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"error-messages",children:"Error Messages"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"OIDC provider unavailable"}),": Provider cannot be reached, local auth available"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Invalid state parameter"}),": Possible CSRF attack or session timeout"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Failed to extract username"}),": Username scope not configured properly"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config validation error: host_url is required"}),": Add ",(0,r.jsx)(n.code,{children:"host_url"})," field to ",(0,r.jsx)(n.code,{children:"server_settings"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config validation error: host_url must include scheme and host"}),": Fix the URL format"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Principle of Least Privilege"}),": Only grant access to labels users need"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Label Design"}),": Design your labeling strategy with authorization in mind"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Admin Access"}),": Admin users bypass all authorization checks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Performance"}),": Authorization filtering is applied efficiently at the API level"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"metrics-authentication",children:"Metrics Authentication"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"/metrics"})," endpoint exposes Prometheus metrics and can be protected with authentication to prevent unauthorized access to monitoring data."]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-1",children:"Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Configure metrics authentication in your ",(0,r.jsx)(n.code,{children:"config.yaml"})," or ",(0,r.jsx)(n.code,{children:"credentials.yaml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  metrics_auth:\n    enabled: true\n    type: "basic" # or "bearer"\n    username: "prometheus"\n    password: "your-secure-password"\n'})}),"\n",(0,r.jsx)(n.p,{children:"For bearer token authentication:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  metrics_auth:\n    enabled: true\n    type: "bearer"\n    token: "your-secret-token"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"authentication-types",children:"Authentication Types"}),"\n",(0,r.jsx)(n.h4,{id:"basic-authentication",children:"Basic Authentication"}),"\n",(0,r.jsx)(n.p,{children:"Use username and password for metrics access:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  metrics_auth:\n    enabled: true\n    type: "basic"\n    username: "prometheus"\n    password: "your-secure-password"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prometheus Configuration"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'scrape_configs:\n  - job_name: "site-availability"\n    static_configs:\n      - targets: ["your-app:8080"]\n    metrics_path: "/metrics"\n    basic_auth:\n      username: "prometheus"\n      password: "your-secure-password"\n'})}),"\n",(0,r.jsx)(n.h4,{id:"bearer-token-authentication",children:"Bearer Token Authentication"}),"\n",(0,r.jsx)(n.p,{children:"Use a simple token for metrics access:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  metrics_auth:\n    enabled: true\n    type: "bearer"\n    token: "your-secret-token"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prometheus Configuration"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'scrape_configs:\n  - job_name: "site-availability"\n    static_configs:\n      - targets: ["your-app:8080"]\n    metrics_path: "/metrics"\n    authorization:\n      type: Bearer\n      credentials: "your-secret-token"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use Strong Credentials"}),": Choose strong passwords or tokens"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Separate Credentials"}),": Use different credentials for metrics vs. user authentication"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Network Security"}),": Consider IP-based restrictions for additional security"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Credential Management"}),": Store sensitive credentials in ",(0,r.jsx)(n.code,{children:"credentials.yaml"})," rather than ",(0,r.jsx)(n.code,{children:"config.yaml"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"disabling-metrics-authentication",children:"Disabling Metrics Authentication"}),"\n",(0,r.jsx)(n.p,{children:"To disable metrics authentication (default behavior):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"server_settings:\n  metrics_auth:\n    enabled: false # or omit the entire metrics_auth section\n"})}),"\n",(0,r.jsx)(n.h3,{id:"troubleshooting-1",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h4,{id:"common-issues-1",children:"Common Issues"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prometheus Scraping Fails"}),": Verify credentials match between server and Prometheus configuration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"401 Unauthorized"}),": Check that metrics authentication is properly configured"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Basic Auth Not Working"}),": Ensure Prometheus is sending the correct Authorization header"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bearer Token Not Working"}),": Verify the token format and value"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"error-messages-1",children:"Error Messages"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Metrics authentication failed"}),": Invalid credentials provided"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"No Authorization header found"}),": Prometheus not sending authentication headers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Invalid metrics auth type"}),": Configuration error in auth type"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"excluded-endpoints",children:"Excluded Endpoints"}),"\n",(0,r.jsxs)(n.p,{children:["The following endpoints are ",(0,r.jsx)(n.strong,{children:"not"})," protected by authentication:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/"})," - Login page and static files"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/sync"})," - B2B endpoint (protected by HMAC authentication)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/healthz"})," - Health check"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/readyz"})," - Readiness check"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/metrics"})," - Metrics endpoint (protected by metrics authentication when enabled)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"sync-configuration",children:"Sync Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Configure server-to-server synchronization:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  sync_enable: true\n  token: "your-hmac-token"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"labels",children:"Labels"}),"\n",(0,r.jsx)(n.p,{children:"Add custom labels to identify this server instance:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  labels:\n    environment: "production"\n    region: "us-east-1"\n    cluster: "main"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  port: "8080"\n  host_url: "https://myserver.com" # Required: Used for OIDC callback URLs\n  session_timeout: "12h"\n  trust_proxy_headers: true # Enable when behind a trusted reverse proxy\n  local_admin:\n    enabled: true\n    username: "admin"\n  roles:\n    frontend:\n      team: "frontend"\n      env: "production"\n    backend:\n      team: "backend"\n      shared: "yes"\n  metrics_auth:\n    enabled: true\n    type: "basic"\n    username: "prometheus"\n    password: "your-secure-metrics-password"\n  sync_enable: true\n  token: "secure-sync-token"\n  labels:\n    environment: "production"\n    region: "us-east-1"\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var i=s(6540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);