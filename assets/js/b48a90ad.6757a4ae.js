"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4452],{7133:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"usage/configuration/sources/prometheus","title":"Prometheus Source Configuration","description":"The Prometheus source monitors applications by making a PromQL query to a Prometheus instance. If the query result is 1, the app is considered up; if 0, it is down.","source":"@site/docs/usage/configuration/sources/prometheus.md","sourceDirName":"usage/configuration/sources","slug":"/usage/configuration/sources/prometheus","permalink":"/site-availability/docs/usage/configuration/sources/prometheus","draft":false,"unlisted":false,"editUrl":"https://github.com/Levy-Tal/site-availability/tree/main/docs/docs/usage/configuration/sources/prometheus.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Server Configuration","permalink":"/site-availability/docs/usage/configuration/server"},"next":{"title":"Site Source Configuration","permalink":"/site-availability/docs/usage/configuration/sources/site"}}');var o=s(4848),t=s(8453);const r={sidebar_position:4},a="Prometheus Source Configuration",l={},c=[{value:"How It Works",id:"how-it-works",level:2},{value:"Minimal Example",id:"minimal-example",level:2},{value:"Source Configuration Options",id:"source-configuration-options",level:2},{value:"App Configuration Options",id:"app-configuration-options",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Example: Bearer Authentication",id:"example-bearer-authentication",level:3},{value:"Example: Basic Authentication",id:"example-basic-authentication",level:3},{value:"Using credentials.yaml for Sensitive Data",id:"using-credentialsyaml-for-sensitive-data",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Example: Kubernetes Cluster Essentials (kube-prometheus-stack)",id:"example-kubernetes-cluster-essentials-kube-prometheus-stack",level:3}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"prometheus-source-configuration",children:"Prometheus Source Configuration"})}),"\n",(0,o.jsxs)(n.p,{children:["The Prometheus source monitors applications by making a PromQL query to a Prometheus instance. If the query result is ",(0,o.jsx)(n.strong,{children:"1"}),", the app is considered ",(0,o.jsx)(n.strong,{children:"up"}),"; if ",(0,o.jsx)(n.strong,{children:"0"}),", it is ",(0,o.jsx)(n.strong,{children:"down"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"For each app, the source sends a PromQL query to the configured Prometheus URL."}),"\n",(0,o.jsxs)(n.li,{children:["If the query result is ",(0,o.jsx)(n.code,{children:"1"}),", the app is ",(0,o.jsx)(n.strong,{children:"up"}),". If ",(0,o.jsx)(n.code,{children:"0"}),", the app is ",(0,o.jsx)(n.strong,{children:"down"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["You can manipulate your PromQL to return 1 or 0 as needed (e.g., using ",(0,o.jsx)(n.code,{children:"up{...}"})," or custom expressions)."]}),"\n",(0,o.jsxs)(n.li,{children:["To flip the result (e.g., if ",(0,o.jsx)(n.code,{children:"up"})," is 0 when you want up), use ",(0,o.jsx)(n.code,{children:"1 - (promql)"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"minimal-example",children:"Minimal Example"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'sources:\n  - name: prometheus-main\n    type: prometheus\n    config:\n      url: http://prometheus:9090\n      apps:\n        - name: myApp\n          location: New York\n          metric: up{instance="app:8080", job="app"}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"source-configuration-options",children:"Source Configuration Options"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"name"}),": Unique name for the source (required)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"type"}),": Must be ",(0,o.jsx)(n.code,{children:"prometheus"})," (required)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"config.url"}),": Prometheus base URL (required)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"config.token"}),": Optional authentication token (for bearer/basic auth)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"config.auth"}),": Optional authentication type (",(0,o.jsx)(n.code,{children:"bearer"})," or ",(0,o.jsx)(n.code,{children:"basic"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"config.apps"}),": List of app configurations (see below)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"app-configuration-options",children:"App Configuration Options"}),"\n",(0,o.jsxs)(n.p,{children:["Each app under ",(0,o.jsx)(n.code,{children:"apps"})," supports the following options:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apps:\n  - name: "myApp" # Required: Unique app name\n    location: "New York" # Required: Must match a defined location\n    metric: \'up{instance="app:8080", job="app"}\' # Required: PromQL query\n    labels: {} # Optional: App-specific labels\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"name"}),": Unique name for the app (required)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"location"}),": Must match a defined location (required)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"metric"}),": PromQL query string (required). Should return 1 for up, 0 for down. You can use expressions like ",(0,o.jsx)(n.code,{children:"1 - up{...}"})," to flip the result."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"labels"}),": Optional key-value labels for this app"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"token"})," and ",(0,o.jsx)(n.code,{children:"auth"})," in the source config for bearer/basic authentication if your Prometheus requires it."]}),"\n",(0,o.jsxs)(n.li,{children:["For sensitive credentials, use ",(0,o.jsx)(n.code,{children:"credentials.yaml"})," with the same structure as your main config."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"example-bearer-authentication",children:"Example: Bearer Authentication"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'sources:\n  - name: prometheus-main\n    type: prometheus\n    config:\n      url: http://prometheus:9090\n      auth: bearer\n      token: "your-bearer-token"\n      apps:\n        - name: myApp\n          location: New York\n          metric: up{instance="app:8080", job="app"}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"example-basic-authentication",children:"Example: Basic Authentication"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'sources:\n  - name: prometheus-main\n    type: prometheus\n    config:\n      url: http://prometheus:9090\n      auth: basic\n      token: "username:password"\n      apps:\n        - name: myApp\n          location: New York\n          metric: up{instance="app:8080", job="app"}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"using-credentialsyaml-for-sensitive-data",children:"Using credentials.yaml for Sensitive Data"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'# config.yaml\nsources:\n  - name: prometheus-main\n    type: prometheus\n    config:\n      url: http://prometheus:9090\n      auth: bearer\n      apps:\n        - name: myApp\n          location: New York\n          metric: up{instance="app:8080", job="app"}\n\n# credentials.yaml\nsources:\n  - name: prometheus-main\n    config:\n      token: "your-bearer-token"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Write PromQL queries that return 1 for up and 0 for down."}),"\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"1 - (promql)"})," to invert results if needed."]}),"\n",(0,o.jsxs)(n.li,{children:["Store sensitive tokens in ",(0,o.jsx)(n.code,{children:"credentials.yaml"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"example-kubernetes-cluster-essentials-kube-prometheus-stack",children:"Example: Kubernetes Cluster Essentials (kube-prometheus-stack)"}),"\n",(0,o.jsxs)(n.p,{children:["The following ",(0,o.jsx)(n.code,{children:"config.yaml"})," monitors core Kubernetes components when you have the kube-prometheus-stack installed. It normalizes availability to a simple up/down signal per component."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'server_settings:\n  host_url: "https://your-site-availability.example.com"\n  port: 8080\n  labels:\n    env: "production"\n    cluster: "prod-cluster-1"\n    region: "us-east-1"\n\nscraping:\n  interval: "30s"\n  timeout: "5s"\n  max_parallel: 10\n\nlocations:\n  - name: "us-east-1"\n    latitude: 39.0438\n    longitude: -77.4874\n\nsources:\n  - name: "prometheus-kps"\n    type: "prometheus"\n    labels:\n      source: "kube-prometheus-stack"\n    config:\n      url: "http://prometheus-operated:9090"\n      apps:\n        # Control plane\n        - name: "kube-apiserver"\n          location: "us-east-1"\n          metric: \'sum(up{job="apiserver"}) > 0\'\n          labels:\n            component: "control-plane"\n\n        - name: "kube-scheduler"\n          location: "us-east-1"\n          metric: \'sum(up{job="kube-scheduler"}) > 0\'\n          labels:\n            component: "control-plane"\n\n        - name: "kube-controller-manager"\n          location: "us-east-1"\n          metric: \'sum(up{job="kube-controller-manager"}) > 0\'\n          labels:\n            component: "control-plane"\n\n        - name: "etcd"\n          location: "us-east-1"\n          metric: \'sum(up{job="etcd"}) > 0\'\n          labels:\n            component: "control-plane"\n\n        # DNS\n        - name: "coredns"\n          location: "us-east-1"\n          metric: \'sum(up{job=~"kube-dns|coredns"}) > 0\'\n          labels:\n            component: "dns"\n\n        # Kubernetes metrics services\n        - name: "kube-state-metrics"\n          location: "us-east-1"\n          metric: \'sum(up{job="kube-state-metrics"}) > 0\'\n          labels:\n            component: "observability"\n\n        - name: "kubelet-scrape-healthy"\n          location: "us-east-1"\n          metric: \'min(up{job="kubelet"}) == 1\'\n          labels:\n            component: "node"\n\n        # Cluster health rollups\n        - name: "all-nodes-ready"\n          location: "us-east-1"\n          metric: \'min(kube_node_status_condition{condition="Ready",status="true"}) == 1\'\n          labels:\n            component: "node"\n\n        - name: "no-crashlooping-pods"\n          location: "us-east-1"\n          metric: \'sum(max_over_time(kube_pod_container_status_waiting_reason{reason="CrashLoopBackOff"}[5m])) == 0\'\n          labels:\n            component: "workload"\n\n        - name: "no-pending-pods"\n          location: "us-east-1"\n          metric: \'sum(kube_pod_status_phase{phase="Pending"}) == 0\'\n          labels:\n            component: "workload"\n'})}),"\n",(0,o.jsx)(n.p,{children:"Notes:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Adjust ",(0,o.jsx)(n.code,{children:"url"})," to your Prometheus service if it differs from ",(0,o.jsx)(n.code,{children:"prometheus-operated:9090"})," (for example, use the fully-qualified service name if in a different namespace)."]}),"\n",(0,o.jsxs)(n.li,{children:["Job names may vary by distribution and chart version; update the ",(0,o.jsx)(n.code,{children:"job="})," matchers accordingly."]}),"\n",(0,o.jsx)(n.li,{children:"Each PromQL returns 1 (up) or 0 (down) to fit the normalized availability model."}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"For more details, see the code or your configuration files."})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var i=s(6540);const o={},t=i.createContext(o);function r(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);