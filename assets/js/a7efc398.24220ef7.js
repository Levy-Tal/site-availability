"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3583],{8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var r=s(6540);const i={},a=r.createContext(i);function t(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(a.Provider,{value:n},e.children)}},9192:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"development/data-structures","title":"Runtime Data Structures","description":"This document provides a comprehensive overview of all runtime data structures in the Site Availability Monitoring application.","source":"@site/docs/development/data-structures.md","sourceDirName":"development","slug":"/development/data-structures","permalink":"/site-availability/docs/development/data-structures","draft":false,"unlisted":false,"editUrl":"https://github.com/Levy-Tal/site-availability/tree/main/docs/docs/development/data-structures.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3}}');var i=s(4848),a=s(8453);const t={sidebar_position:3},c="Runtime Data Structures",l={},o=[{value:"Overview",id:"overview",level:2},{value:"1. Core Application Cache (handlers package)",id:"1-core-application-cache-handlers-package",level:2},{value:"App Status Cache",id:"app-status-cache",level:3},{value:"Location Cache",id:"location-cache",level:3},{value:"Performance Metrics",id:"performance-metrics",level:3},{value:"2. Label Management System (labels package)",id:"2-label-management-system-labels-package",level:2},{value:"Label Manager",id:"label-manager",level:3},{value:"3. Scraping System (scraping package)",id:"3-scraping-system-scraping-package",level:2},{value:"Scrapers Registry",id:"scrapers-registry",level:3},{value:"TLS Configuration",id:"tls-configuration",level:3},{value:"4. Authentication &amp; Authorization (authentication package)",id:"4-authentication--authorization-authentication-package",level:2},{value:"Session Management",id:"session-management",level:3},{value:"RBAC Permissions",id:"rbac-permissions",level:3},{value:"5. Metrics &amp; Monitoring (metrics package)",id:"5-metrics--monitoring-metrics-package",level:2},{value:"Location Source Counts",id:"location-source-counts",level:3},{value:"6. Data Flow Patterns",id:"6-data-flow-patterns",level:2},{value:"Data Ingestion Flow",id:"data-ingestion-flow",level:3},{value:"API Request Flow",id:"api-request-flow",level:3},{value:"7. Concurrency &amp; Thread Safety",id:"7-concurrency--thread-safety",level:2},{value:"Mutex Protection",id:"mutex-protection",level:3},{value:"8. Memory Usage Patterns",id:"8-memory-usage-patterns",level:2},{value:"Memory Allocation Estimates",id:"memory-allocation-estimates",level:3},{value:"Growth Patterns",id:"growth-patterns",level:3},{value:"9. Data Relationships",id:"9-data-relationships",level:2},{value:"10. Performance Characteristics",id:"10-performance-characteristics",level:2},{value:"Access Patterns",id:"access-patterns",level:3},{value:"Update Patterns",id:"update-patterns",level:3},{value:"Optimization Strategies",id:"optimization-strategies",level:3},{value:"11. Circular Scraping Prevention",id:"11-circular-scraping-prevention",level:2},{value:"Deduplication Rules",id:"deduplication-rules",level:3},{value:"Example Scenario",id:"example-scenario",level:3},{value:"Cache Structure Benefits",id:"cache-structure-benefits",level:3},{value:"12. Error Handling &amp; Resilience",id:"12-error-handling--resilience",level:2},{value:"Error States",id:"error-states",level:3},{value:"Recovery Mechanisms",id:"recovery-mechanisms",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"runtime-data-structures",children:"Runtime Data Structures"})}),"\n",(0,i.jsx)(n.p,{children:"This document provides a comprehensive overview of all runtime data structures in the Site Availability Monitoring application."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"The application maintains several interconnected data structures in memory to provide fast access to monitoring data, user sessions, and filtering capabilities. All structures are designed for high-performance read operations with thread-safe concurrent access."}),"\n",(0,i.jsx)(n.h2,{id:"1-core-application-cache-handlers-package",children:"1. Core Application Cache (handlers package)"}),"\n",(0,i.jsx)(n.h3,{id:"app-status-cache",children:"App Status Cache"}),"\n",(0,i.jsx)(n.p,{children:"The primary data structure storing all application status information, organized by origin URL to prevent circular scraping and enable proper deduplication."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"appStatusCache = make(map[string]map[string]map[string]AppStatus)\n// Structure: [origin_url][source][app_name]AppStatus\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'appStatusCache\n\u251c\u2500\u2500 "https://site-a.com" (Origin URL)\n\u2502   \u251c\u2500\u2500 "prometheus-source"\n\u2502   \u2502   \u251c\u2500\u2500 "backend-app" \u2192 AppStatus{...}\n\u2502   \u2502   \u2514\u2500\u2500 "frontend-app" \u2192 AppStatus{...}\n\u2502   \u2514\u2500\u2500 "http-source"\n\u2502       \u251c\u2500\u2500 "api-service" \u2192 AppStatus{...}\n\u2502       \u2514\u2500\u2500 "web-service" \u2192 AppStatus{...}\n\u251c\u2500\u2500 "https://site-b.com" (Origin URL)\n\u2502   \u2514\u2500\u2500 "site-b-source"\n\u2502       \u251c\u2500\u2500 "site-b-app" \u2192 AppStatus{...}\n\u2502       \u2514\u2500\u2500 "scraped-from-c" \u2192 AppStatus{...}\n\u2514\u2500\u2500 "https://site-e.com" (Origin URL)\n    \u2514\u2500\u2500 "site-e-source"\n        \u251c\u2500\u2500 "site-e-app" \u2192 AppStatus{...}\n        \u2514\u2500\u2500 "e-scraped-from-f" \u2192 AppStatus{...}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"AppStatus Object:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'type AppStatus struct {\n    Name      string            // Unique app name within source\n    Location  string            // Geographic location\n    Status    string            // "up", "down", "unavailable"\n    Source    string            // Source name (redundant with map key)\n    OriginURL string            // Where app originally came from\n    Labels    map[string]string // Merged labels (app + source + server)\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Characteristics:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Uniqueness"}),": ",(0,i.jsx)(n.code,{children:"originURL + sourceName + appName"})," forms the unique identifier"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Origin URL Grouping"}),": Apps are grouped by their origin URL for circular prevention"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Source Isolation"}),": Within each origin URL, each source has its own namespace"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Thread Safety"}),": Protected by ",(0,i.jsx)(n.code,{children:"cacheMutex sync.RWMutex"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"URL Normalization"}),": Origin URLs are normalized (lowercase, no trailing slashes, no default ports)"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"location-cache",children:"Location Cache"}),"\n",(0,i.jsx)(n.p,{children:"Stores geographic location information for each source with conflict resolution to prevent duplicates."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"locationCache = make(map[string][]Location)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'locationCache\n\u251c\u2500\u2500 "prometheus-source" \u2192 [Location{Name: "us-east", Lat: 40.7, Lon: -74.0}, ...]\n\u251c\u2500\u2500 "http-source" \u2192 [Location{Name: "us-west", Lat: 37.7, Lon: -122.4}, ...]\n\u2514\u2500\u2500 "site-e-source" \u2192 [Location{Name: "eu-west", Lat: 51.5, Lon: -0.1}, ...]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Conflict Resolution:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Universal Rule"}),": Any source that returns locations will have conflicting locations filtered out"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server Precedence"}),": Server's own configured locations always take precedence over scraped locations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No Duplicates"}),": Prevents duplicate locations when scraped locations match server's configured locations"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Location Object:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type Location struct {\n    Name      string  // Location name\n    Latitude  float64 // Geographic latitude\n    Longitude float64 // Geographic longitude\n    Source    string  // Source that provided this location\n    Status    *string // Calculated status based on apps in location\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"performance-metrics",children:"Performance Metrics"}),"\n",(0,i.jsx)(n.p,{children:"Tracks operational statistics for monitoring and debugging."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"updateMetrics = struct {\n    totalUpdates     int64 // Total number of cache updates\n    totalAppsAdded   int64 // Total apps added to cache\n    totalAppsSkipped int64 // Total apps skipped (filtered)\n    totalErrors      int64 // Total errors encountered\n    avgDurationMs    int64 // Average update duration in milliseconds\n}{}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"2-label-management-system-labels-package",children:"2. Label Management System (labels package)"}),"\n",(0,i.jsx)(n.h3,{id:"label-manager",children:"Label Manager"}),"\n",(0,i.jsx)(n.p,{children:"Provides O(1) filtering capabilities for both system fields and user labels."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type LabelManager struct {\n    appsByField map[string]map[string][]string  // field_name -> value -> [app_ids]\n    mutex       sync.RWMutex\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'labelManager.appsByField\n\u251c\u2500\u2500 "location" (System Field)\n\u2502   \u251c\u2500\u2500 "us-east" \u2192 ["prometheus:backend-app", "http:api-service"]\n\u2502   \u251c\u2500\u2500 "us-west" \u2192 ["prometheus:frontend-app", "http:web-service"]\n\u2502   \u2514\u2500\u2500 "eu-west" \u2192 ["site-e:site-e-app"]\n\u251c\u2500\u2500 "status" (System Field)\n\u2502   \u251c\u2500\u2500 "up" \u2192 ["prometheus:backend-app", "site-e:site-e-app"]\n\u2502   \u2514\u2500\u2500 "down" \u2192 ["http:api-service", "site-e:e-scraped-from-f"]\n\u251c\u2500\u2500 "labels.env" (User Label)\n\u2502   \u251c\u2500\u2500 "prod" \u2192 ["prometheus:backend-app", "site-e:site-e-app"]\n\u2502   \u2514\u2500\u2500 "staging" \u2192 ["http:api-service"]\n\u2514\u2500\u2500 "labels.team" (User Label)\n    \u251c\u2500\u2500 "backend" \u2192 ["prometheus:backend-app"]\n    \u2514\u2500\u2500 "frontend" \u2192 ["prometheus:frontend-app", "http:web-service"]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Features:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Dual Indexing"}),': System fields and user labels with "labels." prefix']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Unique IDs"}),": App identifiers in format ",(0,i.jsx)(n.code,{children:"source:appname"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fast Queries"}),": O(1) lookup for field-based filtering"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"3-scraping-system-scraping-package",children:"3. Scraping System (scraping package)"}),"\n",(0,i.jsx)(n.h3,{id:"scrapers-registry",children:"Scrapers Registry"}),"\n",(0,i.jsx)(n.p,{children:"Maintains a registry of all configured scrapers with generic orchestration."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"Scrapers = make(map[string]Source)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Scrapers\n\u251c\u2500\u2500 "prometheus-source" \u2192 PrometheusScraper{}\n\u251c\u2500\u2500 "http-source" \u2192 HTTPScraper{}\n\u2514\u2500\u2500 "site-e-source" \u2192 SiteScraper{directScrapedSites: ["http://server-b:8080", "http://server-c:8080"]}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Source Interface:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type Source interface {\n    ValidateConfig(source config.Source) error\n    Scrape(source config.Source, serverSettings config.ServerSettings,\n           timeout time.Duration, maxParallel int, tlsConfig *tls.Config)\n           ([]handlers.AppStatus, []handlers.Location, error)\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Generic Orchestration:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Uniform Treatment"}),": All scrapers are treated identically by the orchestration layer"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Encapsulated Logic"}),": Each scraper handles its own specific logic internally"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"No Source-Type Conditionals"}),": The ",(0,i.jsx)(n.code,{children:"Start"})," function makes generic calls to ",(0,i.jsx)(n.code,{children:"scraper.Scrape()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Configuration at Startup"}),": Site scrapers are configured with ",(0,i.jsx)(n.code,{children:"directScrapedSites"})," during initialization"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"tls-configuration",children:"TLS Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Global TLS configuration for secure scraping."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"globalTLSConfig *tls.Config\n"})}),"\n",(0,i.jsx)(n.h2,{id:"4-authentication--authorization-authentication-package",children:"4. Authentication & Authorization (authentication package)"}),"\n",(0,i.jsx)(n.h3,{id:"session-management",children:"Session Management"}),"\n",(0,i.jsx)(n.p,{children:"Manages user sessions with automatic expiration."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type Manager struct {\n    sessions map[string]*Session\n    mutex    sync.RWMutex\n    timeout  time.Duration\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'sessionManager.sessions\n\u251c\u2500\u2500 "sess_abc123" \u2192 Session{\n\u2502   ID: "sess_abc123",\n\u2502   Username: "john.doe",\n\u2502   IsAdmin: false,\n\u2502   Roles: ["developer"],\n\u2502   Groups: ["team-a"],\n\u2502   AuthMethod: "oidc",\n\u2502   CreatedAt: 2024-01-15T10:30:00Z,\n\u2502   ExpiresAt: 2024-01-15T18:30:00Z\n\u2502 }\n\u251c\u2500\u2500 "sess_def456" \u2192 Session{\n\u2502   ID: "sess_def456",\n\u2502   Username: "admin.user",\n\u2502   IsAdmin: true,\n\u2502   Roles: ["admin"],\n\u2502   Groups: ["admin-team"],\n\u2502   AuthMethod: "local",\n\u2502   CreatedAt: 2024-01-15T09:00:00Z,\n\u2502   ExpiresAt: 2024-01-15T17:00:00Z\n\u2502 }\n\u2514\u2500\u2500 "sess_ghi789" \u2192 Session{...}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Session Object:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'type Session struct {\n    ID         string    // Unique session identifier\n    Username   string    // User\'s username\n    IsAdmin    bool      // Admin privileges flag\n    Roles      []string  // User\'s roles\n    Groups     []string  // User\'s groups\n    AuthMethod string    // "local" or "oidc"\n    CreatedAt  time.Time // Session creation timestamp\n    ExpiresAt  time.Time // Session expiration timestamp\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"rbac-permissions",children:"RBAC Permissions"}),"\n",(0,i.jsx)(n.p,{children:"Role-based access control for label filtering."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type UserPermissions struct {\n    IsAdmin       bool\n    AllowedLabels map[string]LabelPermission\n    HasFullAccess bool\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'userPermissions.AllowedLabels\n\u251c\u2500\u2500 "env" \u2192 LabelPermission{\n\u2502   Key: "env",\n\u2502   AllowedValues: ["prod", "staging"],\n\u2502   AllowAll: false\n\u2502 }\n\u251c\u2500\u2500 "team" \u2192 LabelPermission{\n\u2502   Key: "team",\n\u2502   AllowedValues: ["backend", "frontend"],\n\u2502   AllowAll: false\n\u2502 }\n\u2514\u2500\u2500 "region" \u2192 LabelPermission{\n    Key: "region",\n    AllowedValues: ["us-east", "us-west"],\n    AllowAll: false\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"LabelPermission Object:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type LabelPermission struct {\n    Key           string   // Label key\n    AllowedValues []string // Allowed values for this label\n    AllowAll      bool     // Admin can access all values\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"5-metrics--monitoring-metrics-package",children:"5. Metrics & Monitoring (metrics package)"}),"\n",(0,i.jsx)(n.h3,{id:"location-source-counts",children:"Location Source Counts"}),"\n",(0,i.jsx)(n.p,{children:"Tracks metrics per location and source combination."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"locationSourceCounts := make(map[locsrc]struct {\n    count   int\n    sources []string\n})\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'locationSourceCounts\n\u251c\u2500\u2500 locsrc{Location: "us-east", Source: "prometheus"} \u2192 {count: 5, sources: ["prom1", "prom2"]}\n\u251c\u2500\u2500 locsrc{Location: "us-west", Source: "http"} \u2192 {count: 3, sources: ["http1"]}\n\u2514\u2500\u2500 locsrc{Location: "eu-west", Source: "site"} \u2192 {count: 2, sources: ["site-e"]}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"6-data-flow-patterns",children:"6. Data Flow Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"data-ingestion-flow",children:"Data Ingestion Flow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"1. Scrapers (Prometheus/HTTP/Site)\n   \u2193\n2. UpdateAppStatus()\n   \u2193\n3. Group by normalized origin URL\n   \u2193\n4. appStatusCache[originURL][sourceName][appName] = AppStatus\n   \u2193\n5. labelManager.UpdateAppLabels()\n   \u2193\n6. labelManager.appsByField[field][value] = [app_ids]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"api-request-flow",children:"API Request Flow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"1. HTTP Request \u2192 /api/apps?location=us-east&labels.env=prod\n   \u2193\n2. parseFilters() \u2192 filters map\n   \u2193\n3. labelManager.FindAppsByLabels(filters) \u2192 [app_ids]\n   \u2193\n4. filterApps() \u2192 filtered AppStatus slice\n   \u2193\n5. JSON Response\n"})}),"\n",(0,i.jsx)(n.h2,{id:"7-concurrency--thread-safety",children:"7. Concurrency & Thread Safety"}),"\n",(0,i.jsx)(n.h3,{id:"mutex-protection",children:"Mutex Protection"}),"\n",(0,i.jsx)(n.p,{children:"All shared data structures are protected by appropriate mutexes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// handlers package\ncacheMutex sync.RWMutex  // Protects appStatusCache, locationCache\n\n// labels package\nlabelManager.mutex sync.RWMutex  // Protects appsByField\n\n// session package\nsessionManager.mutex sync.RWMutex  // Protects sessions map\n\n// scraping package\n// No global mutex - each scraper is independent\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Locking Strategy:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Read-Write Mutexes"}),": Allow concurrent reads, exclusive writes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fine-grained Locking"}),": Each major structure has its own mutex"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Minimal Lock Time"}),": Locks are held only for the duration of operations"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"8-memory-usage-patterns",children:"8. Memory Usage Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"memory-allocation-estimates",children:"Memory Allocation Estimates"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"appStatusCache: ~3-15 MB (depending on app count and origin URL diversity)\nlocationCache: ~1-5 MB (depending on location count)\nlabelManager: ~5-20 MB (indexing overhead)\nsessionManager: ~1-5 MB (depending on active sessions)\nScrapers: ~1-2 MB (scraper instances)\nTotal: ~11-47 MB typical runtime\n"})}),"\n",(0,i.jsx)(n.h3,{id:"growth-patterns",children:"Growth Patterns"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"appStatusCache"}),": Grows with number of origin URLs \xd7 sources \xd7 apps per source"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"labelManager"}),": Grows with number of unique field values"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"sessionManager"}),": Grows with active user sessions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scrapers"}),": Fixed size based on configured sources"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"9-data-relationships",children:"9. Data Relationships"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"AppStatus \u2190\u2192 Location (via location field)\nAppStatus \u2190\u2192 Labels (via labels map)\nAppStatus \u2190\u2192 Source (via source field)\nAppStatus \u2190\u2192 OriginURL (via origin_url field, used for cache grouping)\nSession \u2190\u2192 UserPermissions (via roles)\nUserPermissions \u2190\u2192 LabelPermission (via allowed labels)\nScrapers \u2190\u2192 AppStatus (via scraping results)\nSiteScraper \u2190\u2192 directScrapedSites (via internal state for circular prevention)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"10-performance-characteristics",children:"10. Performance Characteristics"}),"\n",(0,i.jsx)(n.h3,{id:"access-patterns",children:"Access Patterns"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"App Lookup"}),": O(1) via ",(0,i.jsx)(n.code,{children:"appStatusCache[originURL][source][app]"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Label Filtering"}),": O(1) via ",(0,i.jsx)(n.code,{children:"labelManager.appsByField[field][value]"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Session Validation"}),": O(1) via ",(0,i.jsx)(n.code,{children:"sessions[sessionID]"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Permission Check"}),": O(n) where n = number of user roles"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"update-patterns",children:"Update Patterns"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"App Status Update"}),": O(1) for cache update + O(n) for label reindexing + O(1) for URL normalization"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Session Creation"}),": O(1)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Label Manager Update"}),": O(n\xd7m) where n = apps, m = fields per app"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Location Conflict Resolution"}),": O(n) where n = number of scraped locations"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"optimization-strategies",children:"Optimization Strategies"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pre-allocated Maps"}),": Use ",(0,i.jsx)(n.code,{children:"make(map[string]string, estimatedSize)"})," for known sizes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Index Reuse"}),": Label manager maintains persistent indexes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Batch Operations"}),": Multiple app updates are batched where possible"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Memory Pooling"}),": Reuse objects where appropriate"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"11-circular-scraping-prevention",children:"11. Circular Scraping Prevention"}),"\n",(0,i.jsx)(n.h3,{id:"deduplication-rules",children:"Deduplication Rules"}),"\n",(0,i.jsx)(n.p,{children:"The application implements sophisticated rules to prevent circular scraping:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Origin URL Validation"}),": Apps with empty ",(0,i.jsx)(n.code,{children:"OriginURL"})," are rejected (mandatory field)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"URL Normalization"}),": Origin URLs are normalized for consistent grouping"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Origin URL Grouping"}),": Apps are grouped by normalized origin URL in cache"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Circular Prevention"}),": Site scrapers drop apps from directly scraped sites"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Origin URL Preservation"}),": Site scrapers preserve original origin URLs from scraped apps"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"example-scenario",children:"Example Scenario"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Site A (host_url: https://site-a.com) scrapes:\n\u251c\u2500\u2500 Prometheus source \u2192 OriginURL = https://site-a.com (kept - not a site scraper)\n\u251c\u2500\u2500 Site B (https://site-b.com) \u2192 OriginURL = https://site-b.com (dropped - directly scraped)\n\u2514\u2500\u2500 Site E (https://site-e.com) \u2192 OriginURL preserved from Site E (kept - not directly scraped)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cache-structure-benefits",children:"Cache Structure Benefits"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Prevents Duplicates"}),": Apps with same origin URL are grouped together"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Enables Deduplication"}),": Easy to replace entire source data for an origin URL"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Maintains Uniqueness"}),": ",(0,i.jsx)(n.code,{children:"originURL + sourceName + appName"})," ensures uniqueness"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Supports Circular Prevention"}),": Origin URL grouping enables efficient filtering"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"12-error-handling--resilience",children:"12. Error Handling & Resilience"}),"\n",(0,i.jsx)(n.h3,{id:"error-states",children:"Error States"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Invalid Data"}),": Apps with invalid status/location are corrected or skipped"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scraper Failures"}),": Failed scrapers return empty results, don't crash system"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Memory Pressure"}),": Large datasets are handled gracefully"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Concurrent Access"}),": Race conditions are prevented by proper locking"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"recovery-mechanisms",children:"Recovery Mechanisms"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Graceful Degradation"}),": System continues operating with partial data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Automatic Cleanup"}),": Expired sessions and invalid data are automatically removed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Error Logging"}),": Comprehensive logging for debugging and monitoring"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"This data structure design ensures high performance, thread safety, and scalability while maintaining data integrity and providing rich filtering capabilities."})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);